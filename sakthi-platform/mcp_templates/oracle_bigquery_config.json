{
  "mcp_template_config": {
    "version": "1.0.0",
    "template_type": "oracle_to_bigquery",
    "dynamic_fields": {
      "requires_llm_analysis": true,
      "auto_detect_features": true,
      "generate_descriptions": true
    },
    "llm_analysis_prompts": {
      "file_description": {
        "template": "Analyze this Oracle SQL file and provide a concise description:\n\nFILE CONTENT:\n{{ oracle_sql }}\n\nProvide:\n1. Brief description (1-2 sentences)\n2. Main purpose/functionality\n3. Key Oracle features used\n4. Complexity level (low/medium/high)\n\nFormat as JSON with keys: description, purpose, features, complexity",
        "max_tokens": 300,
        "temperature": 0.1
      },
      "feature_detection": {
        "template": "Detect and analyze Oracle features in this code:\n\n{{ oracle_sql }}\n\nIdentify:\n1. PL/SQL constructs (DECLARE, BEGIN, END, etc.)\n2. Bulk operations (BULK COLLECT, FORALL)\n3. Cursor operations\n4. Exception handling\n5. Data types and variables\n6. Database operations (SELECT, UPDATE, INSERT, DELETE)\n\nReturn as JSON array with feature names and descriptions.",
        "max_tokens": 500,
        "temperature": 0.0
      },
      "conversion_strategy": {
        "template": "Create a conversion strategy for this Oracle code to BigQuery:\n\n{{ oracle_sql }}\n\nProvide conversion approach for:\n1. Data types mapping\n2. PL/SQL constructs → BigQuery SQL\n3. Bulk operations → BigQuery arrays\n4. Error handling strategy\n5. Performance optimization\n\nReturn as structured JSON with conversion_mappings, optimization_tips, and challenges.",
        "max_tokens": 800,
        "temperature": 0.2
      }
    },
    "mcp_template": {
      "mcpVersion": "2024-11-05",
      "server": {
        "name": "{{ server_name | default('sakthi-oracle-mcp') }}",
        "version": "{{ version | default('1.0.0') }}",
        "description": "{{ llm_description | default('Oracle to BigQuery conversion service') }}"
      },
      "capabilities": {
        "resources": {
          "subscribe": true,
          "listChanged": true
        },
        "tools": {
          "listChanged": true
        },
        "prompts": {
          "listChanged": true
        },
        "logging": {
          "level": "{{ log_level | default('info') }}"
        }
      },
      "resources": [
        {
          "uri": "sakthi://oracle/file/{{ file_id }}",
          "name": "{{ resource_name }}",
          "description": "{{ llm_description }}",
          "mimeType": "application/sql",
          "annotations": {
            "source_file": "{{ filename }}",
            "file_size": "{{ file_size }}",
            "analysis_timestamp": "{{ analysis_timestamp }}",
            "complexity": "{{ llm_complexity }}",
            "features_detected": "{{ llm_features }}",
            "conversion_strategy": "{{ llm_conversion_strategy }}",
            "estimated_conversion_time": "{{ estimated_time }}"
          }
        },
        {
          "uri": "sakthi://conversion/mappings/{{ file_id }}",
          "name": "conversion_mappings_{{ file_id }}",
          "description": "Dynamic conversion mappings generated by LLM analysis",
          "mimeType": "application/json",
          "annotations": {
            "data_type_mappings": "{{ data_type_mappings }}",
            "construct_mappings": "{{ construct_mappings }}",
            "optimization_hints": "{{ optimization_hints }}"
          }
        }
      ],
      "tools": [
        {
          "name": "analyze_oracle_file",
          "description": "Analyze uploaded Oracle file with LLM-powered insights",
          "inputSchema": {
            "type": "object",
            "properties": {
              "file_content": {
                "type": "string",
                "description": "Oracle SQL file content"
              },
              "analysis_depth": {
                "type": "string",
                "enum": ["basic", "detailed", "comprehensive"],
                "default": "detailed"
              },
              "include_recommendations": {
                "type": "boolean",
                "default": true
              }
            },
            "required": ["file_content"]
          },
          "outputSchema": {
            "type": "object",
            "properties": {
              "analysis_result": {
                "type": "object",
                "description": "LLM-generated analysis"
              },
              "conversion_plan": {
                "type": "object",
                "description": "Step-by-step conversion plan"
              },
              "bigquery_preview": {
                "type": "string",
                "description": "Preview of BigQuery conversion"
              }
            }
          }
        },
        {
          "name": "validate_conversion",
          "description": "Validate Oracle to BigQuery conversion results",
          "inputSchema": {
            "type": "object",
            "properties": {
              "original_oracle": {
                "type": "string",
                "description": "Original Oracle SQL"
              },
              "converted_bigquery": {
                "type": "string",
                "description": "Converted BigQuery SQL"
              },
              "validation_level": {
                "type": "string",
                "enum": ["syntax", "logic", "performance"],
                "default": "logic"
              }
            },
            "required": ["original_oracle", "converted_bigquery"]
          }
        },
        {
          "name": "generate_migration_template",
          "description": "Generate migration template based on analysis",
          "inputSchema": {
            "type": "object",
            "properties": {
              "file_analysis": {
                "type": "object",
                "description": "Analysis results from LLM"
              },
              "template_type": {
                "type": "string",
                "enum": ["basic", "advanced", "production"],
                "default": "advanced"
              }
            }
          }
        }
      ],
      "prompts": [
        {
          "name": "oracle_expert_analyzer",
          "description": "Expert Oracle code analysis and conversion planning",
          "arguments": [
            {
              "name": "oracle_code",
              "description": "Oracle SQL/PL-SQL code to analyze",
              "required": true
            },
            {
              "name": "conversion_target",
              "description": "Target platform (default: BigQuery)",
              "required": false
            },
            {
              "name": "performance_requirements",
              "description": "Performance requirements and constraints",
              "required": false
            }
          ],
          "template": "{{ prompt_templates.expert_analysis }}"
        },
        {
          "name": "bigquery_converter",
          "description": "Convert Oracle constructs to BigQuery equivalents",
          "arguments": [
            {
              "name": "oracle_construct",
              "description": "Specific Oracle construct to convert",
              "required": true
            },
            {
              "name": "context",
              "description": "Surrounding code context",
              "required": false
            }
          ],
          "template": "{{ prompt_templates.conversion_specialist }}"
        },
        {
          "name": "validation_expert",
          "description": "Validate conversion accuracy and completeness",
          "arguments": [
            {
              "name": "original_code",
              "description": "Original Oracle code",
              "required": true
            },
            {
              "name": "converted_code", 
              "description": "Converted BigQuery code",
              "required": true
            }
          ],
          "template": "{{ prompt_templates.validation_specialist }}"
        }
      ],
      "metadata": {
        "generated_by": "sakthi-platform",
        "template_version": "{{ template_version }}",
        "generation_timestamp": "{{ generation_timestamp }}",
        "llm_model_used": "{{ llm_model }}",
        "analysis_confidence": "{{ analysis_confidence }}",
        "file_metadata": {
          "original_filename": "{{ filename }}",
          "file_hash": "{{ file_hash }}",
          "processing_time_ms": "{{ processing_time }}",
          "features_count": "{{ features_count }}"
        },
        "conversion_metadata": {
          "estimated_accuracy": "{{ estimated_accuracy }}",
          "complexity_score": "{{ complexity_score }}",
          "manual_review_required": "{{ manual_review_required }}",
          "automated_tests_available": "{{ automated_tests_available }}"
        }
      }
    },
    "prompt_templates": {
      "expert_analysis": "You are an Oracle database expert analyzing code for BigQuery migration.\n\nORACLE CODE:\n{{ oracle_code }}\n\nCONVERSION TARGET: {{ conversion_target | default('BigQuery') }}\nPERFORMANCE REQUIREMENTS: {{ performance_requirements | default('Standard') }}\n\nProvide comprehensive analysis:\n\n1. **Code Structure Analysis**\n   - Main functionality and purpose\n   - PL/SQL constructs used\n   - Data operations patterns\n   - Complexity assessment\n\n2. **Migration Challenges**\n   - Oracle-specific features that need special handling\n   - Potential data type conversion issues\n   - Performance considerations\n   - Error handling adaptations\n\n3. **BigQuery Conversion Strategy**\n   - Recommended BigQuery constructs\n   - Data type mappings\n   - Performance optimization opportunities\n   - Testing and validation approach\n\n4. **Risk Assessment**\n   - High-risk conversion areas\n   - Manual verification requirements\n   - Potential data integrity concerns\n\nFormat response as structured analysis with clear recommendations.",
      
      "conversion_specialist": "Convert this Oracle construct to BigQuery equivalent:\n\nORACLE CONSTRUCT:\n{{ oracle_construct }}\n\nCONTEXT:\n{{ context | default('No additional context provided') }}\n\nProvide:\n1. **Direct BigQuery Equivalent**\n   - Exact BigQuery syntax\n   - Any necessary adaptations\n\n2. **Explanation**\n   - Why this approach works\n   - Key differences from Oracle\n   - Performance implications\n\n3. **Alternative Approaches** (if applicable)\n   - Other valid BigQuery patterns\n   - Trade-offs between approaches\n\n4. **Validation Steps**\n   - How to test the conversion\n   - Expected behavior verification\n\nGenerate clean, executable BigQuery code with explanatory comments.",
      
      "validation_specialist": "Validate this Oracle to BigQuery conversion:\n\nORIGINAL ORACLE:\n{{ original_code }}\n\nCONVERTED BIGQUERY:\n{{ converted_code }}\n\nValidation Analysis:\n\n1. **Functional Equivalence**\n   - Logic preservation ✓/✗\n   - Data flow accuracy ✓/✗\n   - Business rule compliance ✓/✗\n\n2. **Technical Correctness**\n   - Syntax validation ✓/✗\n   - Data type compatibility ✓/✗\n   - Performance considerations ✓/✗\n\n3. **Identified Issues**\n   - Critical errors requiring fixes\n   - Warning-level concerns\n   - Optimization opportunities\n\n4. **Recommendations**\n   - Required corrections\n   - Performance improvements\n   - Testing strategies\n\n5. **Confidence Score**\n   - Overall conversion accuracy (0-100%)\n   - Areas of uncertainty\n   - Manual review requirements\n\nProvide actionable feedback for improving the conversion."
    },
    "validation_rules": {
      "required_fields": [
        "filename",
        "oracle_sql",
        "llm_description"
      ],
      "field_validation": {
        "filename": {
          "pattern": "^[a-zA-Z0-9_\\-\\.]+\\.(sql|SQL)$",
          "max_length": 255
        },
        "oracle_sql": {
          "min_length": 10,
          "max_length": 100000
        },
        "complexity": {
          "enum": ["low", "medium", "high"]
        }
      },
      "llm_validation": {
        "description_min_words": 5,
        "features_min_count": 1,
        "max_retry_attempts": 3
      }
    }
  }
}